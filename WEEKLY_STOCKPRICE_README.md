# 📊 Weekly Stock Price Service

## 🎯 서비스 개요

게임 기업들의 **주간 단위 주가 데이터**를 수집하고 분석하는 FastAPI 기반 마이크로서비스입니다.
일일 주가에서 주간 리포트에 최적화된 데이터 수집으로 업그레이드되었습니다.

## ✅ 변경 사항 요약

### 🔄 **수집 방식**: 
- **기존**: 일일 주가 (오늘 vs 어제)
- **신규**: 주간 주가 (이번 주 vs 전주) + 시가총액 + 주간 고점/저점

### 📊 **수집 데이터**:
```json
{
  "symbol": "크래프톤",           // 기업명
  "marketCap": 170000,          // 시가총액 (억원)
  "today": 361500,              // 이번 주 금요일 종가
  "lastWeek": 367500,           // 전주 금요일 종가
  "changeRate": -1.63,          // 주간 등락률 (%)
  "weekHigh": 385000,           // 금주 고점
  "weekLow": 342500             // 금주 저점
}
```

### 🏢 **대상 기업** (10개):
| 기업명 | 종목코드 |
|--------|----------|
| 엔씨소프트 | 036570 |
| 넷마블 | 251270 |
| 크래프톤 | 259960 |
| 펄어비스 | 263750 |
| 컴투스 | 078340 |
| 위메이드 | 112040 |
| 카카오게임즈 | 293490 |
| 네오위즈 | 095660 |
| NHN | 181710 |
| 웹젠 | 069080 |

## 🚀 API 엔드포인트

### 1. **헬스체크**
```http
GET /stockprice/health
```
**응답**:
```json
{"status": "healthy", "service": "weekly_stockprice"}
```

### 2. **게임기업 리스트**
```http
GET /stockprice/companies
```
**응답**:
```json
{
  "companies": {"036570": "엔씨소프트", "251270": "넷마블", ...},
  "total_count": 10
}
```

### 3. **기존 API (하위 호환성)**
```http
GET /stockprice/price?symbol=259960
```
**응답**: 기존 형식 유지하면서 주간 데이터로 내부 로직 변경

### 4. **주간 데이터 (단일 기업)**
```http
GET /stockprice/weekly/259960
```
**응답**: 위의 JSON 형식

### 5. **전체 게임기업 주간 데이터**
```http
GET /stockprice/weekly
```
**응답**: 10개 기업 배열

## 🧪 테스트 결과

### ✅ **단일 기업 테스트 (크래프톤)**
```
🤍[주간 데이터 수집 시작] 심볼: 259960
📊 처리 중: 크래프톤 (259960)
💰 시가총액: 170000억원
📈 일별데이터 수집: 10개
📊 주간통계: 금주종가=361500, 전주종가=367500, 등락률=-1.63%

✅ 테스트 결과:
   기업명: 크래프톤
   시가총액: 170,000억원
   금주 종가: 361,500원
   전주 종가: 367,500원
   주간 등락률: -1.63%
   금주 고점: 385,000원
   금주 저점: 342,500원
```

### ✅ **다중 기업 테스트**
```
📊 수집 결과 요약:
   엔씨소프트: 금주 194,100원 (전주 대비 +12.91%)
   넷마블: 금주 61,100원 (전주 대비 +7.19%)
   크래프톤: 금주 361,500원 (전주 대비 -1.63%)
```

### ✅ **기존 API 호환성**
```
✅ 기존 API 형식 결과:
   symbol: 크래프톤
   today: 361500
   yesterday: 367500          # 전주 금요일로 매핑
   changeRate: -1.63%
   marketCap: 170000         # 새로 추가
   weekHigh: 385000          # 새로 추가
   weekLow: 342500           # 새로 추가
```

## 🔧 구현 세부사항

### **1. 데이터 수집 로직**
```python
# 1. 시가총액 수집
market_cap = await self._fetch_market_cap(stock_code)

# 2. 일별시세 데이터 수집 (최근 2주)
daily_data = await self._fetch_daily_data(stock_code)

# 3. 주간 데이터 계산
weekly_stats = self._calculate_weekly_stats(daily_data)
```

### **2. 주간 통계 계산**
- **금주 종가**: 가장 최근 거래일 종가
- **전주 종가**: 6~10번째 거래일 중 최신 종가
- **주간 등락률**: `((금주 - 전주) / 전주) × 100`
- **금주 고점/저점**: 최근 5거래일 중 최고/최저

### **3. 병렬 처리**
```python
# 10개 기업 동시 데이터 수집
tasks = [self.service.fetch_weekly_stock_data(code) for code in company_codes]
results = await asyncio.gather(*tasks, return_exceptions=True)
```

## 🛠️ 실행 방법

### **1. 서비스 로직 테스트**
```bash
cd weekly_stockprice
python test_weekly_stockprice.py
```

### **2. FastAPI 서버 실행**
```bash
cd weekly_stockprice/app
python main.py
```

### **3. API 테스트** (서버 실행 후)
```bash
python test_api.py
```

## 🎯 주간 리포트 활용

이 서비스는 **주간 단위 자동화 리포트** 생성에 최적화:

1. **매주 금요일 주가 데이터** 자동 수집
2. **전주 대비 변동률** 자동 계산  
3. **시가총액 기반 기업 규모** 파악
4. **주간 고점/저점** 변동성 분석
5. **10개 게임기업 일괄 처리**

## 🔄 업그레이드 내역

| 항목 | 기존 | 신규 |
|------|------|------|
| 수집 주기 | 일일 | 주간 |
| 데이터 포인트 | 3개 | 7개 |
| 시가총액 | ❌ | ✅ |
| 고점/저점 | ❌ | ✅ |
| 병렬 처리 | ❌ | ✅ |
| 하위 호환성 | - | ✅ |

## 🎉 성공 지표

- ✅ **서비스 로직 테스트**: 모든 기업 데이터 수집 성공
- ✅ **시가총액 파싱**: 100% 성공률
- ✅ **일별시세 수집**: 10개 데이터포인트 수집
- ✅ **주간 통계 계산**: 정확한 등락률 계산
- ✅ **하위 호환성**: 기존 API 형식 유지
- ✅ **병렬 처리**: 빠른 다중 기업 데이터 수집

주간 단위 데이터 수집으로 성공적으로 업그레이드 완료! 🚀 